{% extends "base.html" %}

{% block title %}{{ user.name }}'s Movies - MoviWeb{% endblock %}

{% block content %}
    <div class="breadcrumb">
        <a href="{{ url_for('index') }}">Users</a>
        <span>/</span>
        <span>{{ user.name }}</span>
    </div>

    <section class="page-header">
        <h1>{{ user.name }}'s Collection</h1>
        <div class="collection-stats">{{ movies|length }} movies</div>
    </section>

    <div class="layout-grid">
        <div class="movies-section">
            {% if movies %}
                <div class="movies-grid">
                    {% for movie in movies %}
                        <div class="movie-card">
                            <div class="movie-poster">
                                {% if movie.poster_url and movie.poster_url != 'N/A' %}
                                    <img src="{{ movie.poster_url }}" alt="{{ movie.name }} Poster">
                                {% else %}
                                    <div class="poster-placeholder">ðŸŽ¬</div>
                                {% endif %}
                            </div>

                            <div class="movie-info">
                                <h3 class="movie-title">{{ movie.name }}</h3>
                                <div class="movie-meta">
                                    {% if movie.year %}<span class="year">{{ movie.year }}</span>{% endif %}
                                    {% if movie.director %}<span class="director">{{ movie.director }}</span>{% endif %}
                                </div>
                            </div>

                            <div class="movie-actions">
                                <button class="btn btn-small btn-outline" onclick="openUpdateModal('{{ movie.id }}', '{{ movie.name }}')">Edit</button>
                                <button class="btn btn-small btn-danger" onclick="openDeleteModal('{{ movie.id }}', '{{ movie.name }}')">Delete</button>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="empty-state">
                    <div class="empty-icon">ðŸŽ¬</div>
                    <h3>No movies yet</h3>
                    <p>Add your first movie to start building your collection</p>
                </div>
            {% endif %}
        </div>

        <div class="add-movie-section">
            <div class="form-card sticky">
                <h2>Add Movie</h2>
                <form action="{{ url_for('add_movie_to_user', user_id=user.id) }}" method="post" class="form">
                    <div class="form-group">
                        <label for="movie_title">Movie Title</label>
                        <input type="text" id="movie_title" name="movie_title" class="form-input" placeholder="Enter movie title" required>
                        <small class="form-help">Movie details will be fetched automatically</small>
                    </div>
                    <button type="submit" class="btn btn-success">Add Movie</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Update Modal -->
    <div id="updateModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Update Movie</h3>
                <button class="modal-close" onclick="closeModal('updateModal')">&times;</button>
            </div>
            <form id="updateForm" method="post" class="form">
                <div class="form-group">
                    <label for="new_movie_name">Movie Name</label>
                    <input type="text" id="new_movie_name" name="new_movie_name" class="form-input" required>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-outline" onclick="closeModal('updateModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Update</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Delete Modal -->
    <div id="deleteModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Delete Movie</h3>
                <button class="modal-close" onclick="closeModal('deleteModal')">&times;</button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete <strong id="deleteMovieName"></strong>?</p>
                <p class="text-muted">This action cannot be undone.</p>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-outline" onclick="closeModal('deleteModal')">Cancel</button>
                <form id="deleteForm" method="post" style="display: inline;">
                    <button type="submit" class="btn btn-danger">Delete</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        function openUpdateModal(movieId, movieName) {
            document.getElementById('new_movie_name').value = movieName;
            document.getElementById('updateForm').action = `/users/{{ user.id }}/movies/${movieId}/update`;
            document.getElementById('updateModal').style.display = 'block';
        }

        function openDeleteModal(movieId, movieName) {
            document.getElementById('deleteMovieName').textContent = movieName;
            document.getElementById('deleteForm').action = `/users/{{ user.id }}/movies/${movieId}/delete`;
            document.getElementById('deleteModal').style.display = 'block';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        }
    </script>
{% endblock %}